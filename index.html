<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:;base64,=">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>dflow</title>
  <meta name="description" content="is a minimal Dataflow programming engine">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h1>dflow</h1>

    <blockquote>is a minimal <em>Dataflow programming</em> engine</blockquote>

    <div class="container">
    </div>

    <div class="controls">
      <button id="run">Run</button>
      <button id="clear">Clear</button>
    </div>

    <div>
      <pre><code id="execution-report"></code></pre>
    </div>
  </main>

  <script type="module">
    import { FlowView } from 'https://unpkg.com/flow-view';
    import { DflowHost, DflowData } from './dflow.js';
    import { nodesCatalog } from './nodes.js';
    import { onChangeView } from './view.js'

    const flowView = new FlowView({
      container: document.querySelector('.container')
    });

    const dflow = new DflowHost({nodesCatalog});
    const catalog = dflow.nodesCatalog;
    dflow.verbose = true;

    const nodeLabels = Object.keys(catalog);

    flowView.addNodeLabels(nodeLabels);

    const initialGraph = {
      nodes: [
        {
          id: 'a',
          label: '2',
          x: 60, y: 70,
          outputs: [ { id: 'ao1', types: ['number'], data: 2 } ]
        },
        {
          id: 'b',
          label: 'addition',
          x: 60, y: 240,
          inputs: [ { id: 'bi1' }, { id: 'bi2' } ],
          outputs: [ { id: 'bo1' } ]
        },
        {
          id: 'PI',
          label: 'mathPi',
          x: 170, y: 70,
          outputs: [ { id: 'pi' } ]
        }
      ],
      edges: [
        { from: ['a', 'ao1'], to: ['b', 'bi1'] },
        { from: ['a', 'ao1'], to: ['b', 'bi2'] },
      ]
    };

    flowView.onChange(onChangeView({ DflowData, dflow, flowView }))

    flowView.loadGraph(initialGraph);

    // Controls

    const executionReport = document.querySelector('code#execution-report');

    const runButton = document.querySelector('button#run');
    runButton.addEventListener('click', () => {
      executionReport.innerHTML = ''

      dflow.run()

      executionReport.innerHTML = JSON.stringify(dflow.executionReport, null, 2)
    })

    const clearButton = document.querySelector('button#clear');
    clearButton.addEventListener('click', () => {
      flowView.clearGraph();
      dflow.clearGraph()
      executionReport.innerHTML = ''
    })
  </script>

  <footer>
    GitHub: <a href="https://github.com/fibo/dflow">fibo/dflow</a>
  </footer>
</body>
</html>
