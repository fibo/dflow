// http://g14n.info/dflow
require=function e(n,t,r){function o(u,f){if(!t[u]){if(!n[u]){var a="function"==typeof require&&require;if(!f&&a)return a(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[u]={exports:{}};n[u][0].call(s.exports,function(e){var t=n[u][1][e];return o(t||e)},s,s.exports,e,n,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,n,t){n.exports=function(e){return void 0===e||null===e}},{}],2:[function(require,module,exports){function alreadyDefined(e,n){return function(t){return!(n[t]in e)}}function dflowDSL(e){return function(n){var t=e[n];return!isDflowDSL(t)}}function reserved(e){return function(n){var t=e[n];return-1===reservedTaskNames.indexOf(t)}}function evalTasks(funcs,task){function inject(taskKey){var taskName=task[taskKey];try{var e=eval(taskName);funcs[taskName]="function"==typeof e?e:function(){return e}}catch(e){var msg="Task not compiled: "+taskName+" ["+taskKey+"]"+e;throw new Error(msg)}}Object.keys(task).filter(reserved(task)).filter(dflowDSL(task)).filter(alreadyDefined(funcs,task)).forEach(inject)}var isDflowDSL=require("./isDflowDSL"),reservedTaskNames=require("./reservedTaskNames");module.exports=evalTasks},{"./isDflowDSL":16,"./reservedTaskNames":28}],3:[function(e,n,t){function r(e,n){function t(e,n){return y(F[e])&&(F[e]=$(e)),y(F[n])&&(F[n]=$(n)),F[e]-F[n]}function j(e){return!b.test(D[e])}function O(){var n,r=!1,o={};return K.this=function(){return O},K["this.graph"]=function(){return e},a(K,D,arguments),Object.keys(D).filter(j).sort(t).forEach(function(e){var t=h(o,N,e),i=D[e],u=K[i];if(!r){if("return"===i&&!r)return n=t[0],void(r=!0);if(y(u)){var f=new Error("Task not found: "+i+" ["+e+"] ");f.taskKey=e,f.taskName=i}try{o[e]=u.apply(null,t)}catch(n){throw n.taskName=i,n.taskKey=e,n}}}),n}try{k(e,n)}catch(e){throw e}var T=e.func||{},N=e.pipe,D=e.task,F={},$=g.bind(null,N,F),K=o;return K["dflow.fun"]=r,K["dflow.isDflowFun"]=v,K["dflow.validate"]=k,c(K,e),f(K,n),s(K,D),d(K,D),p(K,D),w(K,D),l(K,D),i(K,D),Object.keys(T).forEach(function(t){var o=e.func[t];K["/"+t]=r(o,n)}),Object.keys(D).filter(j).forEach(function(n){var t=D[n];if(!(m.indexOf(t)>-1)){var r="Task not compiled: "+t+" ["+n+"]";if(x.test(t)){var o=t.substring(1);if(y(e.func[o])){var i=new Error(r);throw i.taskKey=n,i.taskName=t,i}}else if(!u(t)&&!E(t)&&y(K[t])){var f=new Error(r);throw f.taskKey=n,f.taskName=t,f}}}),O.graph=e,O}var o=e("./functions/builtin"),i=e("./evalTasks"),u=e("./isDflowDSL"),f=e("./inject/additionalFunctions"),a=e("./inject/arguments"),c=e("./inject/accessors"),s=e("./inject/dotOperators"),d=e("./inject/globals"),l=e("./inject/numbers"),p=e("./inject/references"),w=e("./inject/strings"),h=e("./inputArgs"),v=e("./isDflowFun"),g=e("./level"),y=e("not-defined"),b=e("./regex/comment"),x=e("./regex/subgraph"),m=e("./reservedKeys"),k=e("./validate"),E=e("./walkGlobal");n.exports=r},{"./evalTasks":2,"./functions/builtin":4,"./inject/accessors":6,"./inject/additionalFunctions":7,"./inject/arguments":8,"./inject/dotOperators":9,"./inject/globals":10,"./inject/numbers":11,"./inject/references":12,"./inject/strings":13,"./inputArgs":14,"./isDflowDSL":16,"./isDflowFun":17,"./level":18,"./regex/comment":22,"./regex/subgraph":26,"./reservedKeys":27,"./validate":29,"./walkGlobal":30,"not-defined":1}],4:[function(e,n,t){var r=e("not-defined");t["+"]=function(e,n){return e+n},t["*"]=function(e,n){return e*n},t["-"]=function(e,n){return e-n},t["/"]=function(e,n){return e/n},t["%"]=function(e,n){return e%n},t["&&"]=function(e,n){return e&&n},t["||"]=function(e,n){return e||n},t["!"]=function(e){return!e},t["==="]=function(e,n){return e===n},t["!=="]=function(e,n){return e!==n},t[">"]=function(e,n){return e>n},t["<"]=function(e,n){return e<n},t[">="]=function(e,n){return e>=n},t["<="]=function(e,n){return e<=n},t.eval=function(){throw new Error("eval is not allowed at run time")},t.apply=function(e,n,t){if(!r(e))return e.apply(n,t)},t["."]=function(e,n){if(!r(e)&&!r(n))return e[n]},t["="]=function(e,n){if(!r(e))return e=n},t["=="]=function(e,n){return e==n},t["==="]=function(e,n){return e===n},t.typeof=function(e){return typeof e},t["[]"]=function(){return[]},t["console.error"]=console.error.bind(console),t["console.log"]=console.log.bind(console),t.Infinity=function(){return 1/0},t.NaN=function(){return NaN},t.null=function(){return null},t["{}"]=function(){return{}},t.false=function(){return!1},t.true=function(){return!0},t.now=function(){return new Date}},{"not-defined":1}],5:[function(e,n,t){function r(){return["a","article","aside","button","form","div","h1","h2","h3","h4","h5","input","label","li","link","ol","nav","p","script","svg","textarea","ul"]}var o=e("not-defined"),i=null;t.audioContext=function(){if(i)return i;var e=window.AudioContext||window.webkitAudioContext;return i=new e},t.appendChild=function(e,n){var t=["body","head"];if(!(arguments.length<2)){t.forEach(function(e){if(n===document[e])throw new Error("cannot erase "+e)}),Array.prototype.slice.call(arguments).forEach(function(e){if("function"!=typeof e.appendChild)throw new Error("Cannot appendChild, not an element:"+e)});var r=n.id;if(!o(r)){var i=document.getElementById(r);return i||e.appendChild(n)}}},t.body=function(){return document.body},t.document=function(){return document},t.head=function(){return document.head},t.availableTags=r,["a","article","aside","button","form","div","h1","h2","h3","h4","h5","input","label","li","link","ol","nav","p","script","svg","textarea","ul"].forEach(function(e){t[e]=function(n){var t;if(n&&"string"!=typeof n)throw new TypeError("Element id must be a string:"+n);return(t=document.getElementById(n))||((t=document.createElement(e)).id=n),t}}),t.window=function(){return window}},{"not-defined":1}],6:[function(e,n,t){var r=e("not-defined"),o=e("../regex/accessor");n.exports=function(e,n){r(n.data)&&(n.data={}),e["this.graph.data"]=function(){return n.data},Object.keys(n.task).forEach(function(t){var i=null,u=n.task[t];o.test(u)&&(i=u.substring(1),e[u]=function(e){if(1===arguments.length){var t=JSON.stringify(e);if(r(t))throw new Error("JSON do not serialize data:"+e);n.data[i]=e}return n.data[i]})})}},{"../regex/accessor":20,"not-defined":1}],7:[function(e,n,t){var r=e("not-defined");n.exports=function(e,n){r(n)||Object.keys(n).forEach(function(t){"function"==typeof n[t]&&(e[t]=n[t])})}},{"not-defined":1}],8:[function(e,n,t){var r=e("../regex/argument");n.exports=function(e,n,t){function o(e){return t[e]}Object.keys(n).forEach(function(i){var u=n[i];if("arguments"===u)e[u]=function(){return t};else{var f=r.exec(u);f&&(e[u]=o.bind(null,f[1]))}})}},{"../regex/argument":21}],9:[function(e,n,t){var r=e("not-defined"),o=e("../regex/dotOperator");n.exports=function(e,n){Object.keys(n).forEach(function(t){var i=n[t];o.func.test(i)&&(e[i]=function(e,n){var t;if(n&&(t=n[e]),"function"==typeof t)return t.apply(n,Array.prototype.slice.call(arguments,2))}.bind(null,i.substring(1,i.length-2))),o.attrWrite.test(i)&&(e[i]=function(e,n,t){if(!r(n))return n[e]=t,n}.bind(null,i.substring(1,i.length-1))),o.attrRead.test(i)&&(e[i]=function(e,n){var t;return n&&(t=n[e]),"function"==typeof t?t.bind(n):t}.bind(null,i.substring(1)))})}},{"../regex/dotOperator":23,"not-defined":1}],10:[function(e,n,t){var r=e("not-defined"),o=e("../reservedKeys"),i=e("../walkGlobal");n.exports=function(e,n){Object.keys(n).forEach(function(t){var u=n[t];if("function"!=typeof e[u]&&!(o.indexOf(u)>-1)){var f=i(u);r(f)||(e[u]="function"==typeof f?f:function(){return f})}})}},{"../reservedKeys":27,"../walkGlobal":30,"not-defined":1}],11:[function(e,n,t){n.exports=function(e,n){Object.keys(n).forEach(function(t){var r=n[t],o=parseFloat(r);isNaN(o)||(e[r]=function(){return o})})}},{}],12:[function(e,n,t){var r=e("../regex/reference"),o=e("../walkGlobal");n.exports=function(e,n){Object.keys(n).forEach(function(t){var i=null,u=null,f=n[t];r.test(f)&&(i=f.substring(1),"function"==typeof(u="function"==typeof e[i]?e[i]:o(i))&&(e[f]=function(){return u}))})}},{"../regex/reference":25,"../walkGlobal":30}],13:[function(e,n,t){var r=e("../regex/quoted");n.exports=function(e,n){Object.keys(n).forEach(function(t){var o=n[t];r.test(o)&&(e[o]=function(){return o.substr(1,o.length-2)})})}},{"../regex/quoted":24}],14:[function(e,n,t){var r=e("./inputPipes");n.exports=function(e,n,t){var o=[];return r.bind(null,n)(t).forEach(function(n){var t=n[2]||0,r=e[n[0]];o[t]=r}),o}},{"./inputPipes":15}],15:[function(e,n,t){n.exports=function(e,n){var t=[];return Object.keys(e).filter(function(t){return e[t][1]===n}).forEach(function(n){t.push(e[n])}),t}},{}],16:[function(e,n,t){var r=e("./regex/argument"),o=e("./regex/comment"),i=e("./regex/dotOperator"),u=e("./regex/reference"),f=e("./regex/subgraph");n.exports=function(e){return!!(r.exec(e)||o.test(e)||i.func.test(e)||i.attrRead.test(e)||i.attrWrite.test(e)||u.exec(e)||f.test(e))}},{"./regex/argument":21,"./regex/comment":22,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26}],17:[function(e,n,t){var r=e("./validate");n.exports=function(e){var n="function"==typeof e,t="object"==typeof e.funcs,o="object"==typeof e.graph,i=!0;if(!n||!t||!o)return!1;if(n&&o&&t)try{r(e.graph,e.funcs)}catch(e){i=!1}return i}},{"./validate":29}],18:[function(e,n,t){function r(e,n,t){var i=0,u=o.bind(null,e);return"number"==typeof n[t]?n[t]:(u(t).forEach(function(t){i=Math.max(i,r(e,n,t)+1)}),n[t]=i,i)}var o=e("./parents");n.exports=r},{"./parents":19}],19:[function(e,n,t){var r=e("./inputPipes");n.exports=function(e,n){var t=[];return r.bind(null,e)(n).forEach(function(e){t.push(e[0])}),t}},{"./inputPipes":15}],20:[function(e,n,t){n.exports=/^@[\w][\w\d]+$/},{}],21:[function(e,n,t){n.exports=/^arguments\[(\d+)\]$/},{}],22:[function(e,n,t){n.exports=/^\/\/.+$/},{}],23:[function(e,n,t){t.attrRead=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)$/,t.attrWrite=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)=$/,t.func=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)\(\)$/},{}],24:[function(e,n,t){n.exports=/^'.+'$/},{}],25:[function(e,n,t){n.exports=/^&(.+)$/},{}],26:[function(e,n,t){n.exports=/^\/[\w][\w\d]+$/},{}],27:[function(e,n,t){n.exports=["arguments","dflow.fun","dflow.isDflowFun","dflow.validate","return","this","this.graph"]},{}],28:[function(e,n,t){var r=["dflow.fun","dflow.isDflowFun","dflow.validate","this","this.data.graph","return"];n.exports=r},{}],29:[function(e,n,t){function r(e,n){var t=e.pipe,d=e.task,l=e.data||{},p=e.func||{},w=e.info||{},h={};if("object"==typeof n)for(var v in n){var g=function(e,n){if(e===n)throw new TypeError("Reserved function name: "+e)}.bind(null,v);if(c.forEach(g),u.test(v))throw new TypeError("Reserved function name: "+v);if(i.test(v))throw new TypeError('Function name cannot start with "@": '+v);if(f.attrRead.test(v))throw new TypeError('Function name cannot start with ".":'+v);if(f.attrWrite.test(v))throw new TypeError('Function name cannot start with "." and end with "=":'+v);if(f.func.test(v))throw new TypeError('Function name cannot start with "." and end with "()":'+v);if(a.test(v))throw new TypeError('Function name cannot start with "&": '+v)}if("object"!=typeof t)throw new TypeError("Not an object: pipe "+t);if("object"!=typeof d)throw new TypeError("Not an object: task "+d);if("object"!=typeof l)throw new TypeError("Not an object: data "+l);if("object"!=typeof p)throw new TypeError("Not an object: func "+p);if("object"!=typeof w)throw new TypeError("Not an object: info "+w);return Object.keys(t).forEach(function(e){var n=t[e][2]||0,r=t[e][0],i=t[e][1];if("number"!=typeof n)throw new TypeError("Invalid pipe: "+t[e]);if("string"!=typeof r)throw new TypeError("Invalid pipe: "+t[e]);if("string"!=typeof i)throw new TypeError("Invalid pipe: "+t[e]);if(o(d[r]))throw new Error("Orphan pipe: "+t[e]);if(o(d[i]))throw new Error("Orphan pipe: "+t[e]);if(o(h[r])&&(h[r]={}),o(h[r][i])&&(h[r][i]=[]),!o(h[r][i][n]))throw new Error("Duplicated pipe: "+t[e]);h[r][i][n]=!0}),Object.keys(d).filter(function(e){var n=d[e];return s.test(n)}).forEach(function(e){var n=d[e].substring(1);if(o(p[n]))throw new Error("Undefined subgraph: "+n)}),"object"==typeof p&&Object.keys(p).forEach(function(e){r(p[e],n)}),!0}var o=e("not-defined"),i=e("./regex/accessor"),u=e("./regex/argument"),f=e("./regex/dotOperator"),a=e("./regex/reference"),c=e("./reservedKeys"),s=e("./regex/subgraph");n.exports=r},{"./regex/accessor":20,"./regex/argument":21,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26,"./reservedKeys":27,"not-defined":1}],30:[function(e,n,t){(function(t){var r,o=e("./regex/comment"),i=e("./regex/reference"),u=e("./regex/quoted");"object"==typeof window&&(r=window),"object"==typeof t&&(r=t),n.exports=function(e){if(0!==e.indexOf(".")&&!(o.test(e)||parseFloat(e)||u.test(e)||i.test(e)))return e.split(".").reduce(function(e,n){return e[n]},r)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./regex/comment":22,"./regex/quoted":24,"./regex/reference":25}],dflow:[function(e,n,t){var r=e("../functions/window"),o=e("../fun");t.fun=function(e){var n=arguments[1]||{};return Object.keys(r).forEach(function(e){n[e]=r[e]}),o(e,n)}},{"../fun":3,"../functions/window":5}]},{},[]);