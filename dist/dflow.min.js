// http://g14n.info/dflow
require=function n(e,t,r){function o(u,f){if(!t[u]){if(!e[u]){var a="function"==typeof require&&require;if(!f&&a)return a(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[u]={exports:{}};e[u][0].call(s.exports,function(n){var t=e[u][1][n];return o(t||n)},s,s.exports,n,e,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,e,t){e.exports=function(n){return null==n||n.length<1&&"function"!=typeof n||"object"==typeof n&&Object.keys(n).length<1}},{}],2:[function(require,module,exports){function alreadyDefined(n,e){return function(t){return!(e[t]in n)}}function dflowDSL(n){return function(e){var t=n[e];return!isDflowDSL(t)}}function reserved(n){return function(e){var t=n[e];return-1===reservedTaskNames.indexOf(t)}}function evalTasks(funcs,task){function inject(taskKey){var taskName=task[taskKey];try{var e=eval(taskName);funcs[taskName]="function"==typeof e?e:function(){return e}}catch(n){var msg="Task not compiled: "+taskName+" ["+taskKey+"]"+n;throw new Error(msg)}}Object.keys(task).filter(reserved(task)).filter(dflowDSL(task)).filter(alreadyDefined(funcs,task)).forEach(inject)}var isDflowDSL=require("./isDflowDSL"),reservedTaskNames=require("./reservedTaskNames");module.exports=evalTasks},{"./isDflowDSL":16,"./reservedTaskNames":28}],3:[function(n,e,t){function r(n,e){function t(n,e){return g(F[n])&&(F[n]=$(n)),g(F[e])&&(F[e]=$(e)),F[n]-F[e]}function j(n){return!b.test(D[n])}function O(){var e,r=!1,o={};return K.this=function(){return O},K["this.graph"]=function(){return n},a(K,D,arguments),Object.keys(D).filter(j).sort(t).forEach(function(n){var t=h(o,N,n),i=D[n],u=K[i];if(!r){if("return"===i&&!r)return e=t[0],void(r=!0);if(g(u)){var f=new Error("Task not found: "+i+" ["+n+"] ");f.taskKey=n,f.taskName=i}try{o[n]=u.apply(null,t)}catch(e){throw e.taskName=i,e.taskKey=n,e}}}),e}try{k(n,e)}catch(n){throw n}var T=n.func||{},N=n.pipe,D=n.task,F={},$=y.bind(null,N,F),K=o;return K["dflow.fun"]=r,K["dflow.isDflowFun"]=v,K["dflow.validate"]=k,c(K,n),f(K,e),s(K,D),l(K,D),p(K,D),w(K,D),d(K,D),i(K,D),Object.keys(T).forEach(function(t){var o=n.func[t];K["/"+t]=r(o,e)}),Object.keys(D).filter(j).forEach(function(e){var t=D[e];if(!(m.indexOf(t)>-1)){var r="Task not compiled: "+t+" ["+e+"]";if(x.test(t)){var o=t.substring(1);if(g(n.func[o])){var i=new Error(r);throw i.taskKey=e,i.taskName=t,i}}else if(!u(t)&&!E(t)&&g(K[t])){var f=new Error(r);throw f.taskKey=e,f.taskName=t,f}}}),O.graph=n,O}var o=n("./functions/builtin"),i=n("./evalTasks"),u=n("./isDflowDSL"),f=n("./inject/additionalFunctions"),a=n("./inject/arguments"),c=n("./inject/accessors"),s=n("./inject/dotOperators"),l=n("./inject/globals"),d=n("./inject/numbers"),p=n("./inject/references"),w=n("./inject/strings"),h=n("./inputArgs"),v=n("./isDflowFun"),y=n("./level"),g=n("not-defined"),b=n("./regex/comment"),x=n("./regex/subgraph"),m=n("./reservedKeys"),k=n("./validate"),E=n("./walkGlobal");e.exports=r},{"./evalTasks":2,"./functions/builtin":4,"./inject/accessors":6,"./inject/additionalFunctions":7,"./inject/arguments":8,"./inject/dotOperators":9,"./inject/globals":10,"./inject/numbers":11,"./inject/references":12,"./inject/strings":13,"./inputArgs":14,"./isDflowDSL":16,"./isDflowFun":17,"./level":18,"./regex/comment":22,"./regex/subgraph":26,"./reservedKeys":27,"./validate":29,"./walkGlobal":30,"not-defined":1}],4:[function(n,e,t){var r=n("not-defined");t["+"]=function(n,e){return n+e},t["*"]=function(n,e){return n*e},t["-"]=function(n,e){return n-e},t["/"]=function(n,e){return n/e},t["%"]=function(n,e){return n%e},t["&&"]=function(n,e){return n&&e},t["||"]=function(n,e){return n||e},t["!"]=function(n){return!n},t["==="]=function(n,e){return n===e},t["!=="]=function(n,e){return n!==e},t[">"]=function(n,e){return n>e},t["<"]=function(n,e){return n<e},t[">="]=function(n,e){return n>=e},t["<="]=function(n,e){return n<=e},t["&"]=function(n,e){return n&e},t["|"]=function(n,e){return n|e},t["~"]=function(n){return~n},t["^"]=function(n,e){return n^e},t["<<"]=function(n,e){return n<<e},t[">>"]=function(n,e){return n>>e},t[">>>"]=function(n,e){return n>>>e},t.eval=function(){throw new Error("eval is not allowed at run time")},t.apply=function(n,e,t){if(!r(n))return n.apply(e,t)},t["."]=function(n,e){if(!r(n)&&!r(e))return n[e]},t["="]=function(n,e){if(!r(n))return n=e},t["=="]=function(n,e){return n==e},t["==="]=function(n,e){return n===e},t.typeof=function(n){return typeof n},t["[]"]=function(){return[]},t["console.error"]=console.error.bind(console),t["console.log"]=console.log.bind(console),t.Infinity=function(){return 1/0},t.NaN=function(){return NaN},t.null=function(){return null},t["{}"]=function(){return{}},t.false=function(){return!1},t.true=function(){return!0},t.now=function(){return new Date}},{"not-defined":1}],5:[function(n,e,t){function r(){return["a","article","aside","button","form","div","h1","h2","h3","h4","h5","input","label","li","link","ol","nav","p","script","svg","textarea","ul"]}var o=n("not-defined"),i=null;t.audioContext=function(){if(i)return i;var n=window.AudioContext||window.webkitAudioContext;return i=new n},t.appendChild=function(n,e){var t=["body","head"];if(!(arguments.length<2)){t.forEach(function(n){if(e===document[n])throw new Error("cannot erase "+n)}),Array.prototype.slice.call(arguments).forEach(function(n){if("function"!=typeof n.appendChild)throw new Error("Cannot appendChild, not an element:"+n)});var r=e.id;if(!o(r)){var i=document.getElementById(r);return i||n.appendChild(e)}}},t.body=function(){return document.body},t.document=function(){return document},t.head=function(){return document.head},t.availableTags=r,["a","article","aside","button","form","div","h1","h2","h3","h4","h5","input","label","li","link","ol","nav","p","script","svg","textarea","ul"].forEach(function(n){t[n]=function(e){var t;if(e&&"string"!=typeof e)throw new TypeError("Element id must be a string:"+e);return(t=document.getElementById(e))||((t=document.createElement(n)).id=e),t}}),t.window=function(){return window}},{"not-defined":1}],6:[function(n,e,t){var r=n("not-defined"),o=n("../regex/accessor");e.exports=function(n,e){r(e.data)&&(e.data={}),n["this.graph.data"]=function(){return e.data},Object.keys(e.task).forEach(function(t){var i=null,u=e.task[t];o.test(u)&&(i=u.substring(1),n[u]=function(n){if(1===arguments.length){var t=JSON.stringify(n);if(r(t))throw new Error("JSON do not serialize data:"+n);e.data[i]=n}return e.data[i]})})}},{"../regex/accessor":20,"not-defined":1}],7:[function(n,e,t){var r=n("not-defined");e.exports=function(n,e){r(e)||Object.keys(e).forEach(function(t){"function"==typeof e[t]&&(n[t]=e[t])})}},{"not-defined":1}],8:[function(n,e,t){var r=n("../regex/argument");e.exports=function(n,e,t){function o(n){return t[n]}Object.keys(e).forEach(function(i){var u=e[i];if("arguments"===u)n[u]=function(){return t};else{var f=r.exec(u);f&&(n[u]=o.bind(null,f[1]))}})}},{"../regex/argument":21}],9:[function(n,e,t){var r=n("../regex/dotOperator");e.exports=function(n,e){Object.keys(e).forEach(function(t){var o=e[t];r.func.test(o)&&(n[o]=function(n,e){var t;if(e&&(t=e[n]),"function"==typeof t)return t.apply(e,Array.prototype.slice.call(arguments,2))}.bind(null,o.substring(1,o.length-2))),r.attrWrite.test(o)&&(n[o]=function(n,e,t){return e[n]=t,e}.bind(null,o.substring(1,o.length-1))),r.attrRead.test(o)&&(n[o]=function(n,e){var t;return e&&(t=e[n]),"function"==typeof t?t.bind(e):t}.bind(null,o.substring(1)))})}},{"../regex/dotOperator":23}],10:[function(n,e,t){var r=n("not-defined"),o=n("../reservedKeys"),i=n("../walkGlobal");e.exports=function(n,e){Object.keys(e).forEach(function(t){var u=e[t];if("function"!=typeof n[u]&&!(o.indexOf(u)>-1)){var f=i(u);r(f)||(n[u]="function"==typeof f?f:function(){return f})}})}},{"../reservedKeys":27,"../walkGlobal":30,"not-defined":1}],11:[function(n,e,t){e.exports=function(n,e){Object.keys(e).forEach(function(t){var r=e[t],o=parseFloat(r);isNaN(o)||(n[r]=function(){return o})})}},{}],12:[function(n,e,t){var r=n("../regex/reference"),o=n("../walkGlobal");e.exports=function(n,e){Object.keys(e).forEach(function(t){var i=null,u=null,f=e[t];r.test(f)&&(i=f.substring(1),"function"==typeof(u="function"==typeof n[i]?n[i]:o(i))&&(n[f]=function(){return u}))})}},{"../regex/reference":25,"../walkGlobal":30}],13:[function(n,e,t){var r=n("../regex/quoted");e.exports=function(n,e){Object.keys(e).forEach(function(t){var o=e[t];r.test(o)&&(n[o]=function(){return o.substr(1,o.length-2)})})}},{"../regex/quoted":24}],14:[function(n,e,t){var r=n("./inputPipes");e.exports=function(n,e,t){var o=[];return r.bind(null,e)(t).forEach(function(e){var t=e[2]||0,r=n[e[0]];o[t]=r}),o}},{"./inputPipes":15}],15:[function(n,e,t){e.exports=function(n,e){var t=[];return Object.keys(n).filter(function(t){return n[t][1]===e}).forEach(function(e){t.push(n[e])}),t}},{}],16:[function(n,e,t){var r=n("./regex/argument"),o=n("./regex/comment"),i=n("./regex/dotOperator"),u=n("./regex/reference"),f=n("./regex/subgraph");e.exports=function(n){return!!(r.exec(n)||o.test(n)||i.func.test(n)||i.attrRead.test(n)||i.attrWrite.test(n)||u.exec(n)||f.test(n))}},{"./regex/argument":21,"./regex/comment":22,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26}],17:[function(n,e,t){var r=n("./validate");e.exports=function(n){var e="function"==typeof n,t="object"==typeof n.funcs,o="object"==typeof n.graph,i=!0;if(!e||!t||!o)return!1;if(e&&o&&t)try{r(n.graph,n.funcs)}catch(n){i=!1}return i}},{"./validate":29}],18:[function(n,e,t){function r(n,e,t){var i=0,u=o.bind(null,n);return"number"==typeof e[t]?e[t]:(u(t).forEach(function(t){i=Math.max(i,r(n,e,t)+1)}),e[t]=i,i)}var o=n("./parents");e.exports=r},{"./parents":19}],19:[function(n,e,t){var r=n("./inputPipes");e.exports=function(n,e){var t=[];return r.bind(null,n)(e).forEach(function(n){t.push(n[0])}),t}},{"./inputPipes":15}],20:[function(n,e,t){e.exports=/^@[\w][\w\d]+$/},{}],21:[function(n,e,t){e.exports=/^arguments\[(\d+)\]$/},{}],22:[function(n,e,t){e.exports=/^\/\/.+$/},{}],23:[function(n,e,t){t.attrRead=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)$/,t.attrWrite=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)=$/,t.func=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)\(\)$/},{}],24:[function(n,e,t){e.exports=/^'.+'$/},{}],25:[function(n,e,t){e.exports=/^&(.+)$/},{}],26:[function(n,e,t){e.exports=/^\/[\w][\w\d]+$/},{}],27:[function(n,e,t){e.exports=["arguments","dflow.fun","dflow.isDflowFun","dflow.validate","return","this","this.graph"]},{}],28:[function(n,e,t){var r=["dflow.fun","dflow.isDflowFun","dflow.validate","this","this.data.graph","return"];e.exports=r},{}],29:[function(n,e,t){function r(n,e){var t=n.pipe,l=n.task,d=n.data||{},p=n.func||{},w=n.info||{},h={};if("object"==typeof e)for(var v in e){var y=function(n,e){if(n===e)throw new TypeError("Reserved function name: "+n)}.bind(null,v);if(c.forEach(y),u.test(v))throw new TypeError("Reserved function name: "+v);if(i.test(v))throw new TypeError('Function name cannot start with "@": '+v);if(f.attrRead.test(v))throw new TypeError('Function name cannot start with ".":'+v);if(f.attrWrite.test(v))throw new TypeError('Function name cannot start with "." and end with "=":'+v);if(f.func.test(v))throw new TypeError('Function name cannot start with "." and end with "()":'+v);if(a.test(v))throw new TypeError('Function name cannot start with "&": '+v)}if("object"!=typeof t)throw new TypeError("Not an object: pipe "+t);if("object"!=typeof l)throw new TypeError("Not an object: task "+l);if("object"!=typeof d)throw new TypeError("Not an object: data "+d);if("object"!=typeof p)throw new TypeError("Not an object: func "+p);if("object"!=typeof w)throw new TypeError("Not an object: info "+w);return Object.keys(t).forEach(function(n){var e=t[n][2]||0,r=t[n][0],i=t[n][1];if("number"!=typeof e)throw new TypeError("Invalid pipe: "+t[n]);if("string"!=typeof r)throw new TypeError("Invalid pipe: "+t[n]);if("string"!=typeof i)throw new TypeError("Invalid pipe: "+t[n]);if(o(l[r]))throw new Error("Orphan pipe: "+t[n]);if(o(l[i]))throw new Error("Orphan pipe: "+t[n]);if(o(h[r])&&(h[r]={}),o(h[r][i])&&(h[r][i]=[]),!o(h[r][i][e]))throw new Error("Duplicated pipe: "+t[n]);h[r][i][e]=!0}),Object.keys(l).filter(function(n){var e=l[n];return s.test(e)}).forEach(function(n){var e=l[n].substring(1);if(o(p[e]))throw new Error("Undefined subgraph: "+e)}),"object"==typeof p&&Object.keys(p).forEach(function(n){r(p[n],e)}),!0}var o=n("not-defined"),i=n("./regex/accessor"),u=n("./regex/argument"),f=n("./regex/dotOperator"),a=n("./regex/reference"),c=n("./reservedKeys"),s=n("./regex/subgraph");e.exports=r},{"./regex/accessor":20,"./regex/argument":21,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26,"./reservedKeys":27,"not-defined":1}],30:[function(n,e,t){(function(t){var r,o=n("./regex/comment"),i=n("./regex/reference"),u=n("./regex/quoted");"object"==typeof window&&(r=window),"object"==typeof t&&(r=t),e.exports=function(n){if(0!==n.indexOf(".")&&!(o.test(n)||parseFloat(n)||u.test(n)||i.test(n)))return n.split(".").reduce(function(n,e){return n[e]},r)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./regex/comment":22,"./regex/quoted":24,"./regex/reference":25}],dflow:[function(n,e,t){var r=n("../functions/window"),o=n("../fun");t.fun=function(n){var e=arguments[1]||{};return Object.keys(r).forEach(function(n){e[n]=r[n]}),o(n,e)}},{"../fun":3,"../functions/window":5}]},{},[]);