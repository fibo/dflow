require=function e(n,t,r){function o(u,f){if(!t[u]){if(!n[u]){var a="function"==typeof require&&require;if(!f&&a)return a(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[u]={exports:{}};n[u][0].call(s.exports,function(e){var t=n[u][1][e];return o(t?t:e)},s,s.exports,e,n,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,n,t){n.exports=function(e){return void 0===e||null===e}},{}],2:[function(require,module,exports){function alreadyDefined(e,n){return function(t){return!(n[t]in e)}}function dflowDSL(e){return function(n){return!isDflowDSL(e[n])}}function reserved(e){return function(n){var t=e[n];return reservedTaskNames.indexOf(t)===-1}}function evalTasks(funcs,task){function inject(taskKey){var taskName=task[taskKey];try{var e=eval(taskName);funcs[taskName]="function"==typeof e?e:function(){return e}}catch(e){var msg="Task not compiled: "+taskName+" ["+taskKey+"]"+e;throw new Error(msg)}}Object.keys(task).filter(reserved(task)).filter(dflowDSL(task)).filter(alreadyDefined(funcs,task)).forEach(inject)}var isDflowDSL=require("./isDflowDSL"),reservedTaskNames=require("./reservedTaskNames");module.exports=evalTasks},{"./isDflowDSL":16,"./reservedTaskNames":28}],3:[function(e,n,t){function r(e,n){function t(t){var o=e.func[t];A["/"+t]=r(o,n)}function j(e,n){return g(K[e])&&(K[e]=q(e)),g(K[n])&&(K[n]=q(n)),K[e]-K[n]}function O(e){return!b.test($[e])}function T(n){var t=$[n];if(!(m.indexOf(t)>-1)){var r="Task not compiled: "+t+" ["+n+"]";if(x.test(t)){var o=t.substring(1);if(g(e.func[o])){var i=new Error(r);throw i.taskKey=n,i.taskName=t,i}}else if(!u(t)&&!E(t)&&g(A[t])){var f=new Error(r);throw f.taskKey=n,f.taskName=t,f}}}function N(){function n(e){var n=h(o,F,e),i=$[e],u=A[i];if(!r){if("return"===i&&!r)return t=n[0],void(r=!0);if(g(u)){var f=new Error("Task not found: "+i+" ["+e+"] ");f.taskKey=e,f.taskName=i}try{o[e]=u.apply(null,n)}catch(n){throw n.taskName=i,n.taskKey=e,n}}}var t,r=!1,o={};return A.this=function(){return N},A["this.graph"]=function(){return e},a(A,$,arguments),Object.keys($).filter(O).sort(j).forEach(n),t}try{k(e,n)}catch(e){throw e}var D=e.func||{},F=e.pipe,$=e.task,K={},q=y.bind(null,F,K),A=o;return A["dflow.fun"]=r,A["dflow.isDflowFun"]=v,A["dflow.validate"]=k,c(A,e),f(A,n),s(A,$),d(A,$),p(A,$),w(A,$),l(A,$),i(A,$),Object.keys(D).forEach(t),Object.keys($).filter(O).forEach(T),N.graph=e,N}var o=e("./functions/builtin"),i=e("./evalTasks"),u=e("./isDflowDSL"),f=e("./inject/additionalFunctions"),a=e("./inject/arguments"),c=e("./inject/accessors"),s=e("./inject/dotOperators"),d=e("./inject/globals"),l=e("./inject/numbers"),p=e("./inject/references"),w=e("./inject/strings"),h=e("./inputArgs"),v=e("./isDflowFun"),y=e("./level"),g=e("not-defined"),b=e("./regex/comment"),x=e("./regex/subgraph"),m=e("./reservedKeys"),k=e("./validate"),E=e("./walkGlobal");n.exports=r},{"./evalTasks":2,"./functions/builtin":4,"./inject/accessors":6,"./inject/additionalFunctions":7,"./inject/arguments":8,"./inject/dotOperators":9,"./inject/globals":10,"./inject/numbers":11,"./inject/references":12,"./inject/strings":13,"./inputArgs":14,"./isDflowDSL":16,"./isDflowFun":17,"./level":18,"./regex/comment":22,"./regex/subgraph":26,"./reservedKeys":27,"./validate":29,"./walkGlobal":30,"not-defined":1}],4:[function(e,n,t){var r=e("not-defined");t["+"]=function(e,n){return e+n},t["*"]=function(e,n){return e*n},t["-"]=function(e,n){return e-n},t["/"]=function(e,n){return e/n},t["%"]=function(e,n){return e%n},t["&&"]=function(e,n){return e&&n},t["||"]=function(e,n){return e||n},t["!"]=function(e){return!e},t["==="]=function(e,n){return e===n},t["!=="]=function(e,n){return e!==n},t[">"]=function(e,n){return e>n},t["<"]=function(e,n){return e<n},t[">="]=function(e,n){return e>=n},t["<="]=function(e,n){return e<=n},t.eval=function(){throw new Error("eval is not allowed at run time")},t.apply=function(e,n,t){if(!r(e))return e.apply(n,t)},t["."]=function(e,n){if(!r(e)&&!r(n))return e[n]},t["="]=function(e,n){if(!r(e))return e=n},t["=="]=function(e,n){return e==n},t["==="]=function(e,n){return e===n},t.typeof=function(e){return typeof e},t["[]"]=function(){return[]},t["console.error"]=console.error.bind(console),t["console.log"]=console.log.bind(console),t.Infinity=function(){return 1/0},t.NaN=function(){return NaN},t.null=function(){return null},t["{}"]=function(){return{}},t.false=function(){return!1},t.true=function(){return!0},t.now=function(){return new Date}},{"not-defined":1}],5:[function(e,n,t){function r(){return u?u:u=new(window.AudioContext||window.webkitAudioContext)}function o(){return["a","article","aside","button","form","div","h1","h2","h3","h4","h5","input","label","li","link","ol","nav","p","script","svg","textarea","ul"]}var i=e("not-defined"),u=null;t.audioContext=r,t.appendChild=function(e,n){var t=["body","head"];if(!(arguments.length<2)){t.forEach(function(e){if(n===document[e])throw new Error("cannot erase "+e)}),Array.prototype.slice.call(arguments).forEach(function(e){if("function"!=typeof e.appendChild)throw new Error("Cannot appendChild, not an element:"+e)});var r=n.id;if(!i(r)){var o=document.getElementById(r);return o?o:e.appendChild(n)}}},t.body=function(){return document.body},t.document=function(){return document},t.head=function(){return document.head},t.availableTags=o,o().forEach(function(e){t[e]=function(n){var t;if(n&&"string"!=typeof n)throw new TypeError("Element id must be a string:"+n);return t=document.getElementById(n),t||(t=document.createElement(e),t.id=n),t}}),t.window=function(){return window}},{"not-defined":1}],6:[function(e,n,t){function r(e,n){function t(t){function r(e){if(1===arguments.length){if(o(JSON.stringify(e)))throw new Error("JSON do not serialize data:"+e);n.data[u]=e}return n.data[u]}var u=null,f=n.task[t];i.test(f)&&(u=f.substring(1),e[f]=r)}o(n.data)&&(n.data={}),e["this.graph.data"]=function(){return n.data},Object.keys(n.task).forEach(t)}var o=e("not-defined"),i=e("../regex/accessor");n.exports=r},{"../regex/accessor":20,"not-defined":1}],7:[function(e,n,t){function r(e,n){function t(t){"function"==typeof n[t]&&(e[t]=n[t])}o(n)||Object.keys(n).forEach(t)}var o=e("not-defined");n.exports=r},{"not-defined":1}],8:[function(e,n,t){function r(e,n,t){function r(e){return t[e]}function i(i){var u=n[i];if("arguments"===u)e[u]=function(){return t};else{var f=o.exec(u);f&&(e[u]=r.bind(null,f[1]))}}Object.keys(n).forEach(i)}var o=e("../regex/argument");n.exports=r},{"../regex/argument":21}],9:[function(e,n,t){function r(e,n){function t(t){function r(e,n){var t;if(n&&(t=n[e]),"function"==typeof t)return t.apply(n,Array.prototype.slice.call(arguments,2))}function u(e,n,t){if(!o(n))return n[e]=t,n}function f(e,n){var t;return n&&(t=n[e]),"function"==typeof t?t.bind(n):t}var a=n[t];i.func.test(a)&&(e[a]=r.bind(null,a.substring(1,a.length-2))),i.attrWrite.test(a)&&(e[a]=u.bind(null,a.substring(1,a.length-1))),i.attrRead.test(a)&&(e[a]=f.bind(null,a.substring(1)))}Object.keys(n).forEach(t)}var o=e("not-defined"),i=e("../regex/dotOperator");n.exports=r},{"../regex/dotOperator":23,"not-defined":1}],10:[function(e,n,t){function r(e,n){function t(t){var r=n[t];if("function"!=typeof e[r]&&!(i.indexOf(r)>-1)){var f=u(r);o(f)||(e[r]="function"==typeof f?f:function(){return f})}}Object.keys(n).forEach(t)}var o=e("not-defined"),i=e("../reservedKeys"),u=e("../walkGlobal");n.exports=r},{"../reservedKeys":27,"../walkGlobal":30,"not-defined":1}],11:[function(e,n,t){function r(e,n){function t(t){var r=n[t],o=parseFloat(r);isNaN(o)||(e[r]=function(){return o})}Object.keys(n).forEach(t)}n.exports=r},{}],12:[function(e,n,t){function r(e,n){function t(t){function r(){return f}var u=null,f=null,a=n[t];o.test(a)&&(u=a.substring(1),"function"==typeof(f="function"==typeof e[u]?e[u]:i(u))&&(e[a]=r))}Object.keys(n).forEach(t)}var o=e("../regex/reference"),i=e("../walkGlobal");n.exports=r},{"../regex/reference":25,"../walkGlobal":30}],13:[function(e,n,t){function r(e,n){function t(t){var r=n[t];o.test(r)&&(e[r]=function(){return r.substr(1,r.length-2)})}Object.keys(n).forEach(t)}var o=e("../regex/quoted");n.exports=r},{"../regex/quoted":24}],14:[function(e,n,t){function r(e,n,t){function r(n){var t=n[2]||0,r=e[n[0]];i[t]=r}var i=[];return o.bind(null,n)(t).forEach(r),i}var o=e("./inputPipes");n.exports=r},{"./inputPipes":15}],15:[function(e,n,t){function r(e,n){function t(n){o.push(e[n])}function r(t){return e[t][1]===n}var o=[];return Object.keys(e).filter(r).forEach(t),o}n.exports=r},{}],16:[function(e,n,t){function r(e){return!!o.exec(e)||(!!i.test(e)||(!!u.func.test(e)||(!!u.attrRead.test(e)||(!!u.attrWrite.test(e)||(!!f.exec(e)||!!a.test(e))))))}var o=e("./regex/argument"),i=e("./regex/comment"),u=e("./regex/dotOperator"),f=e("./regex/reference"),a=e("./regex/subgraph");n.exports=r},{"./regex/argument":21,"./regex/comment":22,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26}],17:[function(e,n,t){function r(e){var n="function"==typeof e,t="object"==typeof e.graph,r="object"==typeof e.funcs,i=!0;if(n&&t&&r)try{o(e.graph,e.funcs)}catch(e){i=!1}return i}var o=e("./validate");n.exports=r},{"./validate":29}],18:[function(e,n,t){function r(e,n,t){function i(t){u=Math.max(u,r(e,n,t)+1)}var u=0,f=o.bind(null,e);return"number"==typeof n[t]?n[t]:(f(t).forEach(i),n[t]=u,u)}var o=e("./parents");n.exports=r},{"./parents":19}],19:[function(e,n,t){function r(e,n){function t(e){i.push(e[0])}var r=o.bind(null,e),i=[];return r(n).forEach(t),i}var o=e("./inputPipes");n.exports=r},{"./inputPipes":15}],20:[function(e,n,t){n.exports=/^@[\w][\w\d]+$/},{}],21:[function(e,n,t){n.exports=/^arguments\[(\d+)]$/},{}],22:[function(e,n,t){n.exports=/^\/\/.+$/},{}],23:[function(e,n,t){t.attrRead=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)$/,t.attrWrite=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)=$/,t.func=/^\.([a-zA-Z_$][0-9a-zA-Z_$]+)\(\)$/},{}],24:[function(e,n,t){n.exports=/^'.+'$/},{}],25:[function(e,n,t){n.exports=/^&(.+)$/},{}],26:[function(e,n,t){n.exports=/^\/[\w][\w\d]+$/},{}],27:[function(e,n,t){n.exports=["arguments","dflow.fun","dflow.isDflowFun","dflow.validate","return","this","this.graph"]},{}],28:[function(e,n,t){var r=["dflow.fun","dflow.isDflowFun","dflow.validate","this","this.data.graph","return"];n.exports=r},{}],29:[function(e,n,t){function r(e,n){function t(e,n){if(e===n)throw new TypeError("Reserved function name: "+e)}function d(e){var n=h[e][2]||0,t=h[e][0],r=h[e][1];if("number"!=typeof n)throw new TypeError("Invalid pipe: "+h[e]);if("string"!=typeof t)throw new TypeError("Invalid pipe: "+h[e]);if("string"!=typeof r)throw new TypeError("Invalid pipe: "+h[e]);if(o(v[t]))throw new Error("Orphan pipe: "+h[e]);if(o(v[r]))throw new Error("Orphan pipe: "+h[e]);if(o(x[t])&&(x[t]={}),o(x[t][r])&&(x[t][r]=[]),!o(x[t][r][n]))throw new Error("Duplicated pipe: "+h[e]);x[t][r][n]=!0}function l(e){var n=v[e];return s.test(n)}function p(e){var n=v[e],t=n.substring(1);if(o(g[t]))throw new Error("Undefined subgraph: "+t)}function w(e){r(g[e],n)}var h=e.pipe,v=e.task,y=e.data||{},g=e.func||{},b=e.info||{},x={};if("object"==typeof n)for(var m in n){var k=t.bind(null,m);if(c.forEach(k),u.test(m))throw new TypeError("Reserved function name: "+m);if(i.test(m))throw new TypeError('Function name cannot start with "@": '+m);if(f.attrRead.test(m))throw new TypeError('Function name cannot start with ".":'+m);if(f.attrWrite.test(m))throw new TypeError('Function name cannot start with "." and end with "=":'+m);if(f.func.test(m))throw new TypeError('Function name cannot start with "." and end with "()":'+m);if(a.test(m))throw new TypeError('Function name cannot start with "&": '+m)}if("object"!=typeof h)throw new TypeError("Not an object: pipe "+h);if("object"!=typeof v)throw new TypeError("Not an object: task "+v);if("object"!=typeof y)throw new TypeError("Not an object: data "+y);if("object"!=typeof g)throw new TypeError("Not an object: func "+g);if("object"!=typeof b)throw new TypeError("Not an object: info "+b);return Object.keys(h).forEach(d),Object.keys(v).filter(l).forEach(p),"object"==typeof g&&Object.keys(g).forEach(w),!0}var o=e("not-defined"),i=e("./regex/accessor"),u=e("./regex/argument"),f=e("./regex/dotOperator"),a=e("./regex/reference"),c=e("./reservedKeys"),s=e("./regex/subgraph");n.exports=r},{"./regex/accessor":20,"./regex/argument":21,"./regex/dotOperator":23,"./regex/reference":25,"./regex/subgraph":26,"./reservedKeys":27,"not-defined":1}],30:[function(e,n,t){(function(t){function r(e){function n(e,n){return e[n]}if(0!==e.indexOf(".")&&!(i.test(e)||parseFloat(e)||f.test(e)||u.test(e)))return e.split(".").reduce(n,o)}var o,i=e("./regex/comment"),u=e("./regex/reference"),f=e("./regex/quoted");"object"==typeof window&&(o=window),"object"==typeof t&&(o=t),n.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./regex/comment":22,"./regex/quoted":24,"./regex/reference":25}],dflow:[function(e,n,t){function r(e){function n(e){t[e]=o[e]}var t=arguments[1]||{};return Object.keys(o).forEach(n),i(e,t)}var o=e("../functions/window"),i=e("../fun");t.fun=r},{"../fun":3,"../functions/window":5}]},{},[]);
//# sourceMappingURL=dflow.map