<!DOCTYPE>
<html>
  <head>
    <title>dflow test</title>
    <script type="text/javascript" src="//g14n.info/flow-view/dist/flow-view.js"></script>
    <script type="text/javascript" src="//g14n.info/dflow/dist/dflow.js"></script>
  </head>
  <body onload="dflowTest()">
    <p>The following content is generated by <a href="http://g14n.info/dflow">dflow</a>, client side. Source code is available <a href="https://github.com/fibo/dflow/blob/master/gh-pages/test/page.html">here</a>.<p>

    <script type="text/javascript">
      function dflowTest () {
        var dflow  = require('dflow'),
            render = require('flow-view').render('flow')
            funcs  = {
              createElement: document.createElement.bind(document),
              appendChild: function (parent, child) { return parent.appendChild(child) },
              'body.appendChild': function (child) { return document.body.appendChild(child) },
              createTextNode: document.createTextNode.bind(document)
            },
            graph = {
              task: {
                arg0:               'arguments[0]',
                arg1:               'arguments[1]',
                createElement:      'createElement',
                createTextNode:     'createTextNode',
                appendChild:        'appendChild',
                'body.appendChild': 'body.appendChild',
                'return':           'return'
              },
              pipe: {
                // Read arguments[0] and arguments[1]
                // and pass them to createElement and createTextNode respectively.
                a: ['arg0',             'createElement'     ],
                b: ['arg1',             'createTextNode'    ],
                // appendChild takes inputs from both createElement and createTextNode.
                c: ['createElement',    'appendChild'       ],
                d: ['createTextNode',   'appendChild',     1],
                // createElement returns a DOM node that is appended to body.
                e: ['createElement',    'body.appendChild'  ],
                // body.appendChild returns a DOM node that is returned by the dflow graph.
                f: ['body.appendChild', 'return'            ]
              },
              view: {
                box: {
                  arg0:               { text: 'arguments[0]',     x: 10,  y: 10,                 outs: [{}] },
                  arg1:               { text: 'arguments[1]',     x: 210, y: 10,                 outs: [{}] },
                  createElement:      { text: 'createElement',    x: 10,  y: 100, ins: [{}],     outs: [{}] },
                  createTextNode:     { text: 'createTextNode',   x: 210, y: 100, ins: [{}],     outs: [{}] },
                  appendChild:        { text: 'appendChild',      x: 210, y: 190, ins: [{}, {}], outs: [{}] },
                  'body.appendChild': { text: 'body.appendChild', x: 10,  y: 190, ins: [{}],     outs: [{}] },
                  'return':           { text: 'return',           x: 10,  y: 280, ins: [{}]                 }
                },
                link: {
                  a: { from: ['arg0',             0], to: ['createElement',    0] },
                  b: { from: ['arg1',             0], to: ['createTextNode',   0] },
                  c: { from: ['createElement',    0], to: ['appendChild',      0] },
                  d: { from: ['createTextNode',   0], to: ['appendChild',      1] },
                  e: { from: ['createElement',    0], to: ['body.appendChild', 0] },
                  f: { from: ['body.appendChild', 0], to: ['return',           0] }
                }
              }
            }

        // Add comments.
        var commentRows = [
              'This is a comment',
              '=================',
              '1. Read arguments[0] and arguments[1],',
              '   and pass them to createElement and createTextNode respectively.',
              '2. appendChild takes inputs from both createElement and createTextNode.',
              '3. createElement returns a DOM node that is appended to body.',
              '4. body.appendChild returns a DOM node that is returned by the dflow graph.'
            ]

        graph.view.box.comment = {
          text: commentRows.join('\n'),
          x: 370, y: 10,
          w: 200, h: 5
        }

        var test = dflow.fun(graph, funcs)

        test('h1', 'dflow test')
        test('p', 'it works!')

        // Create a div to show the graph.view
        // <div id="flow"></div>
        test('div', 'you should see a graph view here').id = 'flow'
        render(graph)
      }
    </script>
  </body>
</html>
